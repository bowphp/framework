volumes:
    mysql_data:
        driver: local
    postgres_data:
        driver: local
    redis_data:
        driver: local
    ftp_storage:
        driver: local

networks:
    bowphp_network:
        driver: bridge

services:
    mysql:
        container_name: bowphp_mysql
        image: mysql/mysql-server:8.0
        restart: unless-stopped
        ports:
            - "3306:3306"
        environment:
            MYSQL_DATABASE: test_db
            MYSQL_ROOT_PASSWORD: password
            MYSQL_ROOT_HOST: "%"
            MYSQL_ALLOW_EMPTY_PASSWORD: "no"
        command: --default-authentication-plugin=mysql_native_password
        volumes:
            - mysql_data:/var/lib/mysql
        networks:
            - bowphp_network
        healthcheck:
            test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-ppassword"]
            interval: 10s
            timeout: 5s
            retries: 5
    postgres:
        container_name: bowphp_postgres
        image: postgis/postgis:15-3.3
        restart: unless-stopped
        ports:
            - "5432:5432"
        environment:
            POSTGRES_USER: postgres
            POSTGRES_PASSWORD: postgres
            POSTGRES_DB: postgres
        volumes:
            - postgres_data:/var/lib/postgresql/data
        networks:
            - bowphp_network
        healthcheck:
            test: ["CMD-SHELL", "pg_isready -U bowphp"]
            interval: 10s
            timeout: 5s
            retries: 5
    ftp:
        container_name: bowphp_ftp
        image: papacdev/vsftpd
        restart: unless-stopped
        ports:
            - "21:21"
            - "20:20"
            - "12020-12025:12020-12025"
        environment:
            USER: bob
            PASS: "12345"
        volumes:
            - "ftp_storage:/ftp/$USER"
        networks:
            - bowphp_network
    mail:
        container_name: bowphp_mail
        image: maildev/maildev
        restart: unless-stopped
        ports:
            - "1025:25"
            - "1080:80"
        networks:
            - bowphp_network
        healthcheck:
            test: ["CMD", "nc", "-z", "localhost", "25"]
            interval: 10s
            timeout: 5s
            retries: 5
    beanstalkd:
        container_name: bowphp_beanstalkd
        image: schickling/beanstalkd
        restart: unless-stopped
        ports:
            - "11300:11300"
        networks:
            - bowphp_network
        healthcheck:
            test: ["CMD", "nc", "-z", "localhost", "11300"]
            interval: 10s
            timeout: 5s
            retries: 5
    redis:
        container_name: bowphp_redis
        image: redis:7-alpine
        restart: unless-stopped
        ports:
            - "6379:6379"
        volumes:
            - redis_data:/data
        networks:
            - bowphp_network
        healthcheck:
            test: ["CMD", "redis-cli", "ping"]
            interval: 10s
            timeout: 5s
            retries: 5
        command: redis-server --appendonly yes
    memcached:
        container_name: bowphp_memcached
        image: memcached:1.6-alpine
        restart: unless-stopped
        ports:
            - "11211:11211"
        command:
            - --conn-limit=1024
            - --memory-limit=64
            - --threads=4
        networks:
            - bowphp_network
        healthcheck:
            test: ["CMD", "nc", "-z", "localhost", "11211"]
            interval: 10s
            timeout: 5s
            retries: 5
